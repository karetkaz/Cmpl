inline fpsCounter = true;

void keyboard(int key) {
	trace("keyboard", key);
	if (key == 27) {
		glut.exit();
	}
	if (key == 'f') {
		glut.fullScreen();
	}
}

void reshape(int x, int y) {
	trace("reshape");
	gl.viewport(0, 0, x, y);
	glut.postRedisplay();
}

void display() {
	//trace("display");

	gl.clear(gl.ColorBuffer);

	gl.begin(gl.Points);

	inline res = 192;
	inline pi = 3.14159265358979323846264338327950288419716939937510582097494459;
	inline tmin = -pi;
	inline tmax = +pi;
	inline smin = 0.;
	inline smax = 2. * pi;

	for (int ti = 0; ti < res; ti += 1) {
		double t = tmin + ti * double(tmax - tmin) / res;
		for (int si = 0; si < res; si += 1) {
			double s = smin + si * double(smax - smin) / res;

			inline R = 1.0;
			double x = R * float64.cos(t) * float64.cos(s);
			double y = R * float64.cos(t) * float64.sin(s);
			double z = R * float64.sin(t);

			gl.color(1, 1, 1, 1);
			gl.vertex(x, y, z, 1);
		}
	}

	gl.end();
	glut.swapBuffers();

	static if (fpsCounter) {
		static int clk = 0;
		static int fps = 0;

		fps += 1;
		int now = System.time();
		if (clk != now) {
			debug("fps", fps);
			clk = now;
			fps = 0;
		}
		glut.postRedisplay();
	}
}

glut.onKeyboard(keyboard);

glut.onReshape(reshape);
glut.onDisplay(display);

glut.initDisplayMode(glut.Double|glut.Rgb);

// this wont let wmExec to exit.
glut.mainLoop(800, 600, "Cmpl - OpenGL");
